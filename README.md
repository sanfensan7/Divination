# 智能算命 Divination

一款集成中国传统与西方占卜术于一体的综合性算命应用，支持多种命理分析方法，提供专业、客观且全面的命运解读。

## 功能特点

- **多元化的算命方法**：包含八字、紫微斗数、周易卦象、塔罗牌、占星术和数字命理学等中西方传统算命方式
- **精准的命理分析**：结合传统理论与现代心理学，提供既传统又实用的解读
- **平衡的分析视角**：不仅展示命运优势，也客观指出潜在风险与挑战
- **老黄历功能**：查看每日宜忌、吉凶方位和传统节气信息
- **个性化分析**：根据用户提供的生日、时间等信息生成专属命理报告
- **深度AI整合**：支持接入DeepSeek API，提供更深入、专业的算命结果
- **本地模拟模式**：无需网络连接，也可使用内置模拟引擎生成结果
- **周公解梦功能**：提供专业的梦境解析，融合传统文化和现代心理学
 - **心理测评（MBTI）**：内置自研题库与确定性算法，提供16型人格测试与可视化结果（本地离线、隐私安全）

## 支持的算命方法

### 中国传统算命

- **八字命理**：基于生辰八字的命运分析，解读五行属性与大运流年
- **紫微斗数**：通过星宿排盘解析人生各方面运势
- **周易卦象**：易经六十四卦预测
- **老黄历**：查询每日宜忌、吉凶方位和时辰信息
- **周公解梦**：分析梦境蕴含的预示与寓意，提供传统解读与现代解析

### 西方传统占卜

- **占星术**：通过星盘解读性格与命运
- **塔罗牌**：利用塔罗牌阵进行命运预测
- **数字命理学**：分析生日数字的能量与意义

### 心理测评

- **MBTI 人格测试**：
  - 七级同意度量表（-3 ～ +3），共60道专业题目
  - 确定性算法，答案一致则结果稳定一致
  - 本地题库与计算，离线可用；结果与题库版本一并存档
  - 结果页展示四维度比分与详细类型解读，并可查看历史记录

## 主要功能模块

1. **首页**：展示老黄历信息与算命方法推荐
2. **算命方法**：提供各种算命方式的选择，分为中国传统和西方传统两大类
3. **心理测评**：新增“心理测评”Tab，包含 MBTI 人格测试
3. **个人中心**：保存历史算命结果，方便回顾与比较
4. **设置**：配置DeepSeek API密钥、偏好设置等
5. **解梦专区**：输入梦境内容，获取专业解梦分析

## 技术实现

- **开发语言**：Kotlin
- **UI框架**：Android原生视图系统
- **图形绘制**：自定义视图实现塔罗牌动画等专业图形
- **AI集成**：DeepSeek API提供深度分析
- **本地存储**：保存用户历史记录与偏好设置
 - **MBTI实现**：
   - 题库：`res/raw/mbti_questions.json`（包含 version 与 questions）
   - 计算：`utils/MBTICalculator`（确定性规则，四维独立累计）
   - 提供者：`utils/MBTIQuestionProvider`（懒加载与版本管理）
   - 存储：`utils/MBTIStorageService`（SharedPreferences + Gson 列表存档）
   - UI：`ui/MBTITestFragment`、`ui/MBTIResultFragment` 与对应布局、矢量图标与样式 `values/styles_mbti.xml`

## 使用说明

1. **基本使用**：
   - 在首页查看今日老黄历信息
   - 通过底部导航进入算命页面选择喜欢的算命方式
   - 输入必要的个人信息（如出生日期、时间等）
   - 获取详细的命理分析结果
   - 心理测评：方法页切换至“心理测评”→ 选择“MBTI人格测试”→ 完成60题 → 查看结果与历史

2. **高级功能**：
   - 在设置中配置DeepSeek API密钥，获取更高质量的AI分析
   - 保存感兴趣的结果，建立个人命理档案
   - 使用解梦功能分析梦境的深层含义

## 安装要求

- Android 8.0 (API 26)及以上系统
- 建议屏幕分辨率1080x1920或更高
- 至少100MB可用存储空间

## 开发环境

- Android Studio Arctic Fox或更高版本
- Kotlin 1.5+
- Gradle 7.0+
- JDK 11

## 项目结构

```
app/
├── src/main/
│   ├── java/com/example/divination/
│   │   ├── model/          # 数据模型类
│   │   ├── utils/          # 工具类与服务
│   │   ├── view/           # 自定义视图
│   │   ├── ui/             # UI组件与Fragment
│   │   └── MainActivity.kt # 主活动
│   ├── res/                # 资源文件
│   └── AndroidManifest.xml # 应用清单
└── build.gradle.kts        # 构建配置
```

## 开源许可

本项目采用MIT许可证。详情请参阅LICENSE文件。

## 特别说明

本应用提供的命理分析仅供娱乐参考，不应作为重大决策的依据。我们鼓励用户理性看待命理解读，将其作为生活的参考而非绝对准则。

## 最近更新

### v1.2.0 - 2025-10-22

#### 🧠 新增 MBTI 人格测试模块
- 60 道专业题目、7 级同意度；支持中途保存与继续
- 确定性算法：相同答案必得相同类型，保证一致性与可复测性
- 结果页：四维比分进度条与详细类型说明；支持历史记录与再次测试
- 新增“心理测评”Tab，可快速筛选 MBTI 测评

#### 🎨 MBTI 页面美化
- 统一 `MBTI.SectionCard`、`MBTI.PrimaryButton` 等样式；与全局紫金主题一致
- 优化测试页按钮色阶、卡片阴影与间距；结果页标题卡片采用渐变背景

#### 🔧 其他
- 修复 `ic_mbti.xml` 矢量图兼容性（circle→path）
- Manifest 清理 `package` 属性提示，构建更干净

### v1.1.4 - 2024-12-19

#### 🎨 全新UI美化升级
- **神秘紫金主题**：采用优雅的紫色渐变配色方案，营造神秘玄学氛围
- **全面界面重设计**：所有页面采用现代化Material Design风格
- **渐变背景装饰**：添加精美的渐变背景和装饰元素
- **圆角卡片设计**：统一使用16dp圆角，提升视觉层次感
- **金色点缀元素**：使用金色作为强调色，增强神秘感

#### ✨ 加载动画系统
- **全屏加载动画**：为所有算命方法添加美观的加载动画
- **个性化提示文本**：每种算命方法都有专属的加载提示
  - 八字：🔮 正在推算八字命盘... / ⚡ 天干地支排列中...
  - 周易：🔮 正在起卦问天... / ☯ 推演卦象变化...
  - 塔罗：🔮 塔罗牌正在为您占卜... / 🃏 解读牌面能量...
  - 占星：🔮 计算星盘位置... / 🌟 分析行星相位...
- **多重动画效果**：
  - 淡入缩放动画
  - 旋转进度指示器
  - 文字脉动效果
  - 三个金色指示点波浪动画
- **智能状态管理**：防止重复提交，提升用户体验

#### 🔧 技术优化
- **DeepSeek API升级**：更新至DeepSeek-V3.2-Exp模型
- **API密钥内置**：无需手动输入，开箱即用
- **设置页面重构**：移除API输入，新增AI模型信息和使用统计
- **错误处理增强**：更稳定的网络请求和异常处理

#### 📱 用户体验提升
- **首页卡片重设计**：中国传统和西方算命方法采用卡片式布局
- **点击事件修复**：解决首页按钮不跳转的问题
- **视觉反馈优化**：所有交互都有明确的视觉反馈
- **加载状态明确**：用户清楚知道系统正在处理请求

#### 修复的问题

1. **删除结果末尾的字数统计文本**
   - 增强了`parseResponseToSections`方法中处理字数统计文本的正则表达式
   - 添加了多种可能的格式变体，如"（全文共计***字"、"(共计***字"等
   - 确保所有可能的字数统计文本都能被正确删除

2. **优化塔罗牌内容分段功能**
   - 改进了`splitTarotContent`方法的分段能力：
     - 能够识别并使用内容中已有的标题格式（如【】、[]、()等）
     - 增加了更多关键词来识别不同类型的段落（如概览、牌面解读、分析、建议等）
     - 添加了智能分段功能，在无法识别明确段落标识时，根据内容长度比例自动分段
   - 确保塔罗牌解析结果始终呈现清晰的分段结构

#### 新增功能

3. **周公解梦功能完善**
   - 添加了专门的`simulateDreamResponse`模拟响应方法，支持解梦分析
   - 实现了智能梦境内容识别，能够从用户输入中提取关键梦境元素
   - 包含29种常见梦境类型的专业解析（如飞行、坠落、考试、亲人等）
   - 提供分层结构化的解梦结果：
     - 梦境概述：梦境类型和形成原因分析
     - 传统解读：基于《周公解梦》的传统文化解析
     - 现代解析：融合现代心理学和神经科学的解释
     - 启示与建议：基于梦境内容的个性化指导
   - 智能判断梦境吉凶，不同梦境类型有不同的权重分配
   - 引用经典解梦理论，增强解析的文化深度

4. **UI界面优化**
   - 重新设计了主页面布局，提升用户体验
   - 优化了算命结果展示页面，增加动画效果
   - 新增黑暗模式支持，保护夜间使用时的视力
   - 改进了卡片视图设计，使界面更加现代化

5. **系统性能提升**
   - 优化了AI请求处理流程，减少等待时间
   - 引入缓存机制，提高频繁访问内容的加载速度
   - 减少内存占用，提升应用运行稳定性

这些改进确保了应用能够更好地处理各种格式的AI响应，提供更清晰、结构化的占卜结果展示，同时大幅提升了用户体验。 